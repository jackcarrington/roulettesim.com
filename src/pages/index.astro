---
import DefaultLayout from '@layouts/DefaultLayout.astro'
import Hero from '@components/Hero.astro'
import Feature from '@components/Feature.astro'
import GameGridPro from '@components/game/GameGridPro.tsx'
import SEOHead from '@components/seo/SEOHead.astro'
import { api } from '../services/apiClient.ts';
import type { RouletteGame } from '../types/game.ts';

// GameGridPro will handle loading games internally to avoid promise serialization issues

const title = 'Roulette Simulator - Practice & Master Roulette | Roulettesim.com';
const description = 'Ultimate roulette simulator with authentic casino games. Practice European, American, and French roulette variants risk-free. Master strategies with our professional roulette simulator.';

const homepageSchema = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "Roulette Simulator - Roulettesim.com",
  "description": "Professional roulette simulator with authentic casino games and educational content",
  "url": "https://roulettesim.com",
  "mainEntityOfPage": "https://roulettesim.com",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "https://roulettesim.com/games/?q={search_term_string}",
    "query-input": "required name=search_term_string"
  }
};
---

<DefaultLayout title={title} description={description}>
  <SEOHead 
    title={title}
    description={description}
    canonical="https://roulettesim.com"
    openGraph={{
      title: 'Roulette Simulator - Professional Practice Games',
      description,
      image: 'https://roulettesim.com/social-preview-image.png',
      type: 'website'
    }}
    schema={homepageSchema}
  />
  
  <Hero />
  
  <!-- Professional Roulette Simulator Games -->
  <section class="game-library-section my-16">
    <div class="container">
      <div class="text-center mb-12">
        <h2 class="text-4xl font-bold mb-4">Roulette Simulator Games</h2>
        <p class="text-xl max-w-3xl mx-auto text-gray-600 mb-8">
          Experience authentic casino roulette with our professional simulator. Practice strategies, master variants, and perfect your gameplay risk-free.
        </p>
      </div>
      
      
      <!-- Games loaded via API with fallback to mock data -->
      <div class="games-container">
        <script>
          function generateGameSlug(game) {
            return game.name.toLowerCase()
              .replace(/[^a-z0-9]+/g, '-')
              .replace(/^-+|-+$/g, '');
          }

          fetch('/api/games')
            .then(r => r.json())
            .then(data => {
              const container = document.querySelector('.games-container');
              if (data.games && data.games.length > 0) {
                container.innerHTML = `
                  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8">
                    ${data.games.map(game => `
                      <div class="group hover:shadow-lg transition-all duration-300 overflow-hidden bg-white rounded-lg shadow">
                        <div class="aspect-video relative overflow-hidden bg-gray-100 flex items-center justify-center">
                          ${game.thumbnail ? `
                            <img
                              src="${game.thumbnail}"
                              alt="${game.name} preview"
                              class="w-full h-full object-cover"
                              loading="lazy"
                              onerror="this.parentElement.innerHTML='<div class=\\"text-gray-500 text-sm\\">Game Preview</div>'"
                            />
                          ` : `
                            <div class="text-gray-500 text-sm">Game Preview</div>
                          `}
                          <div class="absolute top-2 right-2">
                            <div class="px-2 py-1 rounded text-xs font-medium ${
                              game.variant === 'european' ? 'bg-green-100 text-green-800' :
                              game.variant === 'american' ? 'bg-red-100 text-red-800' :
                              game.variant === 'french' ? 'bg-blue-100 text-blue-800' :
                              'bg-gray-100 text-gray-800'
                            }">${game.variant}</div>
                          </div>
                          ${game.metadata && game.metadata.popularity > 70 ? `
                            <div class="absolute top-2 left-2">
                              <div class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs font-medium flex items-center">
                                <span class="mr-1">‚≠ê</span>Popular
                              </div>
                            </div>
                          ` : ''}
                        </div>
                        <div class="p-4">
                          <h3 class="text-lg font-semibold line-clamp-1 mb-2">${game.name}</h3>
                          <p class="text-sm text-gray-600 mb-2">${game.provider}</p>
                          <div class="space-y-2 mb-4">
                            <div class="flex justify-between text-sm">
                              <span class="text-gray-600">Betting Range:</span>
                              <span class="font-medium">$${game.metadata.minBet} - $${game.metadata.maxBet}</span>
                            </div>
                            ${game.metadata.features && game.metadata.features.length > 0 ? `
                              <div class="flex flex-wrap gap-1">
                                ${game.metadata.features.slice(0, 3).map(feature => `
                                  <span class="px-2 py-1 bg-gray-100 text-gray-700 rounded text-xs">${feature}</span>
                                `).join('')}
                              </div>
                            ` : ''}
                          </div>
                          <a
                            href="/games/${generateGameSlug(game)}"
                            class="button w-full justify-center has-icon"
                            aria-label="Play ${game.name} roulette game"
                          >
                            <svg class="w-4 h-4" aria-hidden="true" fill="currentColor" viewBox="0 0 24 24">
                              <path d="M8 5v14l11-7z"/>
                            </svg>
                            Play Game
                          </a>
                        </div>
                      </div>
                    `).join('')}
                  </div>
                  ${data.notice ? `<div class="text-center"><p class="text-orange-600 bg-orange-50 px-4 py-2 rounded-lg inline-block">${data.notice}</p></div>` : ''}
                `;
              } else {
                container.innerHTML = `
                  <div class="text-center py-12">
                    <div class="mx-auto max-w-md">
                      <h3 class="text-lg font-semibold text-gray-900 mb-2">No games available</h3>
                      <p class="text-gray-600 mb-4">Please check back later or try a different variant.</p>
                      <a href="/games" class="button color-secondary">Browse All Games</a>
                    </div>
                  </div>
                `;
              }
            })
            .catch(e => {
              console.error('API Error:', e);
              document.querySelector('.games-container').innerHTML = `
                <div class="bg-red-50 border border-red-200 text-red-800 px-6 py-4 rounded-lg mb-8 max-w-2xl mx-auto text-center">
                  <h3 class="font-semibold mb-2">Games temporarily unavailable</h3>
                  <p class="mb-2">Unable to load games at this time.</p>
                  <p class="text-sm mb-4">Please try again later or explore our educational content.</p>
                  <div class="flex gap-2 justify-center">
                    <a href="/games" class="button color-secondary">Browse Games</a>
                    <a href="/strategy" class="button">Strategy Guides</a>
                  </div>
                </div>
              `;
            });
        </script>
        <div class="text-center py-16">
          <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
          <p class="text-gray-600">Loading roulette games...</p>
        </div>
      </div>
    </div>
  </section>

  <section class="my-16 py-16 bg-neutral-200">
    <div class="container">
      <h2 class="mb-12 text-4xl font-bold text-center">Why Use Our Roulette Simulator?</h2>
      <div class="grid grid-cols-1 gap-8 md:grid-cols-3">
        <Feature icon="lucide:target" title="Professional Training">
          Practice with authentic casino mechanics. Our simulator uses real game engines from top providers for genuine roulette experience.
        </Feature>
        <Feature icon="lucide:brain" title="Strategy Development">
          Test betting systems, bankroll management, and advanced strategies. Perfect your approach with unlimited practice rounds.
        </Feature>
        <Feature icon="lucide:shield-check" title="Risk-Free Learning">
          Master roulette variants without financial risk. Build confidence and understanding before playing with real money.
        </Feature>
      </div>
    </div>
  </section>
</DefaultLayout>

<style>
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  @media (max-width: 768px) {
    .container {
      padding: 0 0.75rem;
    }
    .primary-cta {
      width: 100%;
      max-width: 300px;
    }
  }
  .bg-neutral-200 { background-color: var(--color-neutral-200); }
</style>