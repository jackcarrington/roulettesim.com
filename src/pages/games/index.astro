---
import DefaultLayout from '@layouts/DefaultLayout.astro';
import GameLibrary from '@components/game/GameLibrary.astro';
import VariantSelector from '@components/game/VariantSelector.astro';
import { api } from '../../services/apiClient.ts';

let games = [];
let error = null;

try {
  games = await api.getRouletteGames();
} catch (err) {
  error = err instanceof Error ? err.message : 'Failed to load games';
  console.error('Failed to load games:', err);
}

const title = 'Roulette Games Library';
const description = 'Practice authentic roulette games from top casino providers. Learn strategies while playing European, American, and French roulette variants.';
---

<DefaultLayout title={title} description={description}>
  <section class="my-12">
    <div class="container">
      <header class="text-center mb-8">
        <h1 class="text-4xl font-bold mb-4">Practice Roulette Games</h1>
        <p class="text-xl text-gray-600 max-w-3xl mx-auto">
          Master roulette with authentic casino games. Choose your variant and start practicing with real game mechanics.
        </p>
      </header>

      <VariantSelector />

      {error ? (
        <div class="error-message bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg mb-6">
          <h3 class="font-semibold mb-2">Games temporarily unavailable</h3>
          <p>{error}</p>
          <p class="mt-2 text-sm">Please try again later or explore our <a href="/strategy" class="underline">educational content</a>.</p>
        </div>
      ) : null}

      <GameLibrary games={games} />

      {games.length > 0 && (
        <div class="educational-cta mt-12 p-6 bg-blue-50 border border-blue-200 rounded-lg text-center">
          <h3 class="font-bold text-xl mb-2">New to Roulette?</h3>
          <p class="text-gray-700 mb-4">
            Learn the rules and strategies before you play. Our comprehensive guides help you understand the odds and make informed decisions.
          </p>
          <a 
            href="/strategy" 
            class="inline-block bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
          >
            Learn Roulette Strategy
          </a>
        </div>
      )}
    </div>
  </section>
</DefaultLayout>

<style>
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  @media (max-width: 768px) {
    .container {
      padding: 0 0.75rem;
    }
  }
</style>