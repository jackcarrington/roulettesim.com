# Story 5.2: Enhanced Brand Color Authority System

## Story Information

**Epic:** 5 - Brownfield Design System Enhancement
**Story Number:** 5.2
**Status:** Draft

## Story Statement

As a **product designer**,
I want **expanded casino-grade color palette with roulette-specific brand variants**,
so that **visual authority and conversion optimization can be enhanced without compromising accessibility**.

## Acceptance Criteria

**AC1: Extend existing OKLCH color system with roulette-domain colors**
- Add casino red (`--brand-casino`), green table (`--brand-table`), and gold accents (`--brand-premium`) to existing OKLCH system
- Maintain current OKLCH color space patterns for mathematical color manipulation
- Generate full 100-900 scale variants using existing `oklch(from var() l c h)` pattern
- Preserve existing color generation formulas and light-dark mode automation

**AC2: Maintain backward compatibility with existing brand colors**
- Keep existing `--brand-primary` and `--brand-secondary` base colors unchanged
- Preserve all current color variable names and semantic tokens
- Ensure existing components continue to function without modification
- Maintain current CSS variable fallback patterns

**AC3: Add new color families with full OKLCH variant scales**
- `--brand-casino` family: 100-900 variants for casino red authority
- `--brand-table` family: 100-900 variants for roulette table green
- `--brand-premium` family: 100-900 variants for premium gold accents
- Each family follows existing OKLCH lightness/chroma patterns

**AC4: Preserve light-dark mode automation and contrast compliance**
- All new colors must pass WCAG 4.5:1+ contrast ratios in both light and dark modes
- Implement automatic light-dark mode switching using existing `light-dark()` function
- Maintain current contrast validation patterns across all color combinations
- Ensure casino colors work with existing semantic token system

**AC5: Create conversion state color authority tokens**
- `--color-engagement`: For active user interaction states
- `--color-recommendation`: For casino recommendation highlights
- `--color-premium`: For premium feature differentiation
- Each conversion token includes hover, active, and focus variants

**AC6: Implement CSS variable fallbacks**
- All new color variables include fallbacks to existing brand colors
- Graceful degradation ensures existing components remain unaffected
- Progressive enhancement allows opt-in adoption of new casino colors
- Fallback patterns maintain visual hierarchy and accessibility

## Dev Notes

### System Architecture Context
[Source: 5.1 Design System Audit, _root.scss analysis, OKLCH color system documentation]

**Existing OKLCH Color Foundation:**
The current system uses advanced OKLCH color space for mathematical color manipulation:

```scss
// Current _root.scss foundation
:root {
  // Base brand colors
  --brand-primary: #1e40af;   // Educational authority blue
  --brand-secondary: #00d1b7; // Interactive cyan
  --brand-neutral: #b9bec4;   // Neutral text/backgrounds

  // OKLCH palette generation (DO NOT MODIFY)
  --color-primary-100: oklch(from var(--brand-primary) 95% calc(c * 0.3) h);
  --color-primary-200: oklch(from var(--brand-primary) 90% calc(c * 0.5) h);
  // ... continues through 900

  // Automated light-dark mode (PRESERVE PATTERN)
  --foreground-color: light-dark(var(--color-neutral-800), var(--color-neutral-100));
  --background-color: light-dark(var(--color-neutral-100), var(--color-neutral-900));
}
```

**Casino Color Psychology Research:**
- **Casino Red (#dc2626)**: Conveys excitement, urgency, premium experience
- **Table Green (#16a34a)**: Traditional roulette table color, trust, stability
- **Premium Gold (#f59e0b)**: Luxury, exclusivity, high-value positioning

**Color Authority Enhancement Strategy:**
1. **Additive Only**: New colors extend existing system without breaking changes
2. **OKLCH Consistency**: All new colors follow existing mathematical patterns
3. **Semantic Integration**: New colors integrate with existing semantic token system
4. **Progressive Enhancement**: Components can opt-in to casino colors gradually

**WCAG Compliance Requirements:**
- All color combinations must maintain 4.5:1+ contrast ratios
- Light-dark mode automation must work with casino colors
- Existing accessibility patterns must be preserved
- Casino colors must pass automated contrast validation

### File Structure and Implementation Locations
[Source: docs/architecture/source-tree.md]

**Primary Implementation Files:**
- `/src/assets/scss/base/_root.scss` - Add new casino color variables
- `/src/assets/scss/base/_button.scss` - Extend with casino color variants
- `/src/components/ui/` - Update Shadcn components with new color tokens
- `/src/utils/colorValidation.ts` - Create WCAG compliance validation utility

**Testing Implementation:**
- `/src/assets/scss/__tests__/color-system.test.ts` - CSS variable validation
- `/tests/e2e/accessibility/color-contrast.spec.ts` - WCAG compliance testing
- `/src/components/__tests__/casino-colors.test.tsx` - Component integration testing

**Documentation Updates:**
- `/docs/design-system-audit/brand-color-analysis.md` - Update with casino colors
- `/docs/design-system/color-tokens.md` - Document new color families

### Component Integration Strategy
[Source: 5.1 Component Inventory, Button System Analysis]

**Dual Button System Enhancement:**
1. **SCSS `.button` Extensions:**
   - Add `.button.variant-casino`, `.button.variant-table`, `.button.variant-premium`
   - Maintain existing `.color-secondary` and `.has-icon` functionality
   - Preserve all current hover, focus, and accessibility states

2. **Shadcn Button Integration:**
   - Extend CVA variant system with casino color options
   - Maintain Radix UI accessibility foundation
   - Add new variant props: `variant="casino" | "table" | "premium"`

**Component Opt-in Pattern:**
```tsx
// Existing components continue to work unchanged
<button class="button">Play Game</button>

// New casino enhancement opt-in
<button class="button variant-casino">Casino Exclusive</button>
<Button variant="premium">Premium Roulette</Button>
```

**State Management Integration:**
- Casino colors integrate with existing `sessionState.ts` for user preferences
- Theme selection persists using current localStorage patterns
- Analytics tracking for casino color engagement via `analyticsService.ts`

### Performance and Build Considerations
[Source: 5.1 Performance Baseline, astro.config.mjs]

**CSS Variable System Impact:**
- New colors add ~15 variables to existing 145-variable system (minimal impact)
- OKLCH calculations performed at build time (no runtime cost)
- CSS custom property inheritance maintained for optimal performance
- Light-dark mode automation continues to use CSS-only approach

**Bundle Size Considerations:**
- Casino colors use existing OKLCH patterns (no new CSS functions)
- Color variables compiled to static values in production build
- Fallback system ensures graceful degradation without code bloat
- Tree-shaking eliminates unused color variants in component builds

### Testing Standards
[Source: docs/architecture/testing-strategy.md]

**Unit Testing Requirements:**
- Color contrast validation for all new casino color combinations
- CSS variable compilation testing in build pipeline
- OKLCH color generation accuracy validation
- Fallback system functionality verification

**Integration Testing:**
- Casino color integration with existing component APIs
- Light-dark mode functionality with new colors
- State management integration for casino color preferences
- Cross-browser color rendering consistency

**Accessibility Testing:**
- WCAG AA compliance for all casino color combinations
- Screen reader compatibility with enhanced color semantics
- Color blindness testing for casino red/green combinations
- High contrast mode compatibility

**Performance Testing:**
- CSS variable compilation impact on build times
- Runtime performance of light-dark mode switching
- Bundle size impact measurement
- Core Web Vitals maintenance with enhanced colors

## Tasks / Subtasks

### Task 1: Extend OKLCH Color System with Casino Colors (AC: 1, 3)
- [ ] 1.1. Add base casino color variables to `_root.scss` (`--brand-casino`, `--brand-table`, `--brand-premium`)
- [ ] 1.2. Generate full 100-900 OKLCH variant scales for each casino color family
- [ ] 1.3. Implement OKLCH lightness/chroma patterns matching existing color system
- [ ] 1.4. Create automated color generation using existing `oklch(from var() l c h)` pattern
- [ ] 1.5. Unit test: Validate OKLCH color generation accuracy and mathematical consistency

### Task 2: Preserve Backward Compatibility (AC: 2, 6)
- [ ] 2.1. Verify all existing `--brand-primary`, `--brand-secondary` variables remain unchanged
- [ ] 2.2. Test existing component functionality with casino colors added
- [ ] 2.3. Implement CSS variable fallback patterns for graceful degradation
- [ ] 2.4. Create progressive enhancement opt-in system for casino colors
- [ ] 2.5. Unit test: Existing component compatibility validation across color system changes

### Task 3: Light-Dark Mode Integration (AC: 4)
- [ ] 3.1. Implement `light-dark()` function for all casino color semantic tokens
- [ ] 3.2. Create casino color variants optimized for light and dark modes
- [ ] 3.3. Validate WCAG 4.5:1+ contrast ratios for all casino color combinations
- [ ] 3.4. Integrate casino colors with existing semantic token system
- [ ] 3.5. Unit test: Contrast ratio validation for all light-dark mode combinations

### Task 4: Conversion State Color Authority (AC: 5)
- [ ] 4.1. Create `--color-engagement` tokens for active user interaction states
- [ ] 4.2. Implement `--color-recommendation` tokens for casino recommendation highlights
- [ ] 4.3. Design `--color-premium` tokens for premium feature differentiation
- [ ] 4.4. Add hover, active, and focus variants for each conversion token
- [ ] 4.5. Unit test: Conversion token accessibility and semantic consistency validation

### Task 5: Button System Casino Color Integration (AC: 1, 2, 5)
- [ ] 5.1. Extend SCSS `.button` class with casino color variants
- [ ] 5.2. Add Shadcn button component casino color variant support
- [ ] 5.3. Maintain existing button accessibility features with new colors
- [ ] 5.4. Implement conversion state integration for casino button variants
- [ ] 5.5. Unit test: Button system compatibility across existing and casino color variants

### Task 6: Color Validation and Documentation (AC: 4, 6)
- [ ] 6.1. Create automated WCAG contrast validation utility for casino colors
- [ ] 6.2. Implement build-time color compliance checking
- [ ] 6.3. Document casino color usage patterns and best practices
- [ ] 6.4. Create color authority guidelines for conversion optimization
- [ ] 6.5. Integration test: End-to-end color system validation and compliance verification

## Project Structure Notes

**Alignment with Existing Architecture:**
- Casino color implementation follows established OKLCH patterns in `_root.scss`
- Component integration respects existing domain organization (`/components/{domain}/`)
- Testing approach aligns with current Vitest + Playwright + Axe framework
- Documentation structure compatible with existing design system audit format

**Integration Compatibility:**
- Additive-only approach ensures zero breaking changes to existing functionality
- Progressive enhancement allows gradual adoption across component ecosystem
- CSS variable fallback system maintains backward compatibility
- Performance impact minimal due to existing OKLCH infrastructure

**No Architecture Conflicts Identified:**
- Casino color system extends existing CSS variable architecture without conflicts
- Component integration patterns align with established Astro + React islands approach
- Testing requirements compatible with current accessibility and performance standards
- Build system integration preserves existing Vite + Tailwind CSS 4 configuration

## Testing Requirements

**Unit Testing (Vitest):**
- OKLCH color generation mathematical accuracy validation
- CSS variable compilation and fallback system verification
- WCAG contrast ratio compliance automated testing
- Component API compatibility with casino color extensions

**Integration Testing:**
- Light-dark mode functionality with casino colors
- Button system integration across SCSS and Shadcn variants
- State management integration for casino color preferences
- Cross-browser color rendering consistency validation

**End-to-End Testing (Playwright):**
- Complete casino color user journey validation
- Conversion optimization flow with enhanced color authority
- Mobile casino interaction with touch-optimized color states
- Performance impact measurement for enhanced color system

**Accessibility Testing (Axe):**
- WCAG AA compliance verification for all casino color combinations
- Color blindness accessibility testing for red/green casino colors
- High contrast mode compatibility validation
- Screen reader semantic enhancement verification

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-19 | v1.0 | Initial story creation for enhanced brand color authority system | Development Agent (James) |

## Dev Agent Record

### Agent Model Used
*To be populated during implementation*

### Debug Log References
*To be populated during implementation*

### Completion Notes List
*To be populated during implementation*

### File List
*To be populated during implementation*

## QA Results

*Results from QA Agent review to be completed after implementation*