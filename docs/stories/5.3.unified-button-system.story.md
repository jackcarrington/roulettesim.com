# Story 5.3: Unified Button System Architecture

## Story Information

**Epic:** 5 - Brownfield Design System Enhancement
**Story Number:** 5.3
**Status:** Draft

## Story Statement

As a **frontend developer**,
I want **harmonized button system combining SCSS and Shadcn patterns**,
so that **consistent button behavior is maintained while enabling advanced interaction states**.

## Acceptance Criteria

**AC1: Extend existing SCSS `.button` class with Shadcn-compatible variant classes**
- Add new variant classes: `.button.variant-casino`, `.button.variant-premium`, `.button.size-lg`
- Maintain existing `.button`, `.button.color-secondary`, `.button.has-icon` API compatibility
- Preserve current SCSS architecture patterns and CSS variable integration
- Ensure new variants work with existing hover animations and focus states

**AC2: Create React wrapper component bridging SCSS styles with Shadcn functionality**
- Develop UnifiedButton component combining SCSS `.button` with Shadcn capabilities
- Maintain Radix UI accessibility foundation and Slot pattern composition
- Support both SCSS class-based and Shadcn variant-based prop interfaces
- Enable seamless switching between SCSS and React button implementations

**AC3: Maintain all existing button APIs and functionality**
- Preserve `.button`, `.button.color-secondary`, `.button.has-icon` class-based APIs
- Keep existing hover animations, focus states, and accessibility features
- Maintain current touch target sizes (44px minimum) for mobile casino interactions
- Ensure backward compatibility for all 25+ existing components using buttons

**AC4: Add casino-specific variant support**
- Implement `.button.variant-casino` for casino red authority buttons
- Add `.button.variant-premium` for premium gold accent buttons
- Create `.button.size-lg` for enhanced mobile casino game interactions
- Integrate casino colors from Story 5.2 with button variant system

**AC5: Preserve existing accessibility features and enhance interaction states**
- Maintain WCAG 4.5:1+ contrast ratios across all button variants
- Keep existing focus indicators, screen reader support, and keyboard navigation
- Enhance casino variants with premium interaction states (hover, active, loading)
- Ensure touch accessibility for mobile casino game interfaces

**AC6: Implement gradual migration path allowing coexistence**
- Create opt-in enhancement system for existing components
- Enable both SCSS and Shadcn button systems to coexist during migration
- Provide clear upgrade path documentation for development team
- Implement feature flags for A/B testing casino button variants

## Dev Notes

### System Architecture Context
[Source: 5.1 Button System Analysis, existing SCSS button implementation, Shadcn integration]

**Current Dual Button System Analysis:**

1. **SCSS `.button` System** (`/src/assets/scss/base/_button.scss`):
```scss
.button {
  // Base button foundation
  padding: var(--space-sm) var(--space-md);
  background: var(--color-primary-500);
  color: var(--foreground-color);
  border-radius: var(--radius-md);

  // Existing variants
  &.color-secondary {
    background: var(--color-secondary-500);
  }

  &.has-icon {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
  }

  // Hover and focus states
  &:hover { transform: translateY(-1px); }
  &:focus { outline: 2px solid var(--color-primary-300); }
}
```

2. **Shadcn Button System** (`/src/components/ui/button.tsx`):
```tsx
const buttonVariants = cva(
  "inline-flex items-center justify-center rounded-md text-sm font-medium",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground",
        secondary: "bg-secondary text-secondary-foreground",
        // Casino variants to be added
      },
      size: {
        default: "h-10 px-4 py-2",
        lg: "h-11 px-8",
        // Additional sizes for casino interactions
      }
    }
  }
)
```

**Component Usage Patterns Across Codebase:**
- **Educational Components**: Use SCSS `.button` for CTAs and navigation
- **Interactive Components**: Use Shadcn Button for state-dependent interactions
- **Conversion Components**: Mix of both systems based on functionality requirements
- **Game Components**: Primarily SCSS `.button` for consistency with casino themes

**Unified Architecture Strategy:**
1. **Extend SCSS System**: Add casino variants while preserving existing patterns
2. **Bridge Component**: Create UnifiedButton for React components needing SCSS styling
3. **Gradual Migration**: Allow teams to upgrade incrementally without breaking changes
4. **API Compatibility**: Maintain existing prop interfaces for seamless adoption

### Casino Button Variant Specifications
[Source: 5.2 Casino Color System, casino industry UX patterns]

**Casino Variant Design Requirements:**
```scss
.button.variant-casino {
  background: var(--brand-casino);
  color: white;
  box-shadow: 0 4px 8px rgba(220, 38, 38, 0.3);

  &:hover {
    background: var(--color-casino-600);
    box-shadow: 0 6px 12px rgba(220, 38, 38, 0.4);
    transform: translateY(-2px);
  }
}

.button.variant-premium {
  background: linear-gradient(135deg, var(--brand-premium), #f97316);
  color: var(--color-neutral-900);
  position: relative;

  &::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, transparent, rgba(255,255,255,0.2));
    border-radius: inherit;
  }
}
```

**Enhanced Interaction States:**
- **Loading State**: Spinner animation for casino game loading
- **Success State**: Checkmark animation for successful actions
- **Disabled State**: Appropriate casino-themed disabled styling
- **Touch States**: Enhanced feedback for mobile casino interactions

### React UnifiedButton Bridge Component
[Source: Shadcn button implementation, React component patterns]

**UnifiedButton Component Architecture:**
```tsx
interface UnifiedButtonProps {
  // Existing SCSS class support
  className?: string;

  // Shadcn variant system
  variant?: 'default' | 'secondary' | 'casino' | 'premium';
  size?: 'default' | 'lg' | 'sm';

  // Bridge functionality
  useScss?: boolean; // Opt-in to SCSS styling
  enhancedStates?: boolean; // Enable casino interaction states

  // Accessibility
  'aria-label'?: string;
  disabled?: boolean;
  loading?: boolean;
}

export function UnifiedButton({
  className,
  variant = 'default',
  size = 'default',
  useScss = false,
  enhancedStates = false,
  children,
  ...props
}: UnifiedButtonProps) {
  // Implementation bridges SCSS and Shadcn patterns
}
```

**Bridge Component Benefits:**
- **API Flexibility**: Supports both SCSS class-based and prop-based APIs
- **Gradual Migration**: Teams can upgrade components incrementally
- **State Management**: Integrates with existing React state patterns
- **Accessibility**: Maintains Radix UI accessibility foundation

### File Structure and Implementation Locations
[Source: docs/architecture/source-tree.md, component organization patterns]

**Primary Implementation Files:**
- `/src/assets/scss/base/_button.scss` - Extend with casino variants and size options
- `/src/components/ui/unified-button.tsx` - Create bridge component
- `/src/components/ui/button.tsx` - Update Shadcn button with casino variants
- `/src/lib/button-variants.ts` - Centralize variant logic for consistency

**Component Integration Points:**
- `/src/components/game/` - Update game components with casino button variants
- `/src/components/conversion/` - Enhance conversion components with premium buttons
- `/src/components/education/` - Maintain existing educational button patterns
- `/src/components/safety/` - Preserve existing safety-focused button styling

**Testing Implementation:**
- `/src/components/__tests__/unified-button.test.tsx` - Bridge component testing
- `/src/assets/scss/__tests__/button-variants.test.ts` - SCSS variant validation
- `/tests/e2e/buttons/casino-interactions.spec.ts` - Casino button E2E testing

### Migration Strategy and Coexistence
[Source: brownfield enhancement requirements, team adoption patterns]

**Phase 1: Additive Enhancement (Current Sprint)**
- Add casino variants to existing SCSS `.button` system
- Create UnifiedButton bridge component for React integration
- Implement feature flags for A/B testing casino variants
- Document migration patterns for development team

**Phase 2: Gradual Adoption (Next 2-3 Sprints)**
- Migrate high-impact conversion components to casino variants
- Update game interaction components with enhanced button states
- Train development team on UnifiedButton usage patterns
- Gather user feedback on casino button engagement

**Phase 3: System Consolidation (Future Consideration)**
- Evaluate migration of all components to UnifiedButton
- Consider deprecating separate SCSS and Shadcn button systems
- Implement automated migration tools for remaining components
- Full casino button system documentation and best practices

**Coexistence Patterns:**
```tsx
// Existing SCSS pattern continues to work
<a className="button color-secondary">Learn Rules</a>

// Enhanced casino variant opt-in
<a className="button variant-casino">Play Now</a>

// React bridge component for advanced functionality
<UnifiedButton variant="premium" enhancedStates loading={isLoading}>
  Premium Roulette
</UnifiedButton>
```

### Performance and Accessibility Considerations
[Source: 5.1 Performance Baseline, WCAG compliance requirements]

**Performance Impact Analysis:**
- Casino variants add ~20 lines to existing 150-line button SCSS (minimal impact)
- UnifiedButton component adds ~2KB to bundle (acceptable for enhanced functionality)
- CSS-only animations maintain 60fps performance on mobile devices
- Casino interaction states use GPU-accelerated transforms

**Accessibility Enhancement:**
- All casino variants maintain WCAG 4.5:1+ contrast ratios
- Enhanced focus indicators for casino gaming accessibility
- Screen reader announcements for loading and success states
- Touch target optimization for mobile casino game interactions

**Cross-browser Compatibility:**
- Casino button variants tested across Chrome, Firefox, Safari, Edge
- CSS custom property fallbacks for older browsers
- Progressive enhancement ensures graceful degradation
- Mobile casino interaction testing across iOS and Android devices

### Testing Standards
[Source: docs/architecture/testing-strategy.md, accessibility testing requirements]

**Unit Testing Requirements:**
- UnifiedButton component prop interface validation
- SCSS casino variant compilation and output verification
- Accessibility state management testing
- Performance impact measurement for enhanced interaction states

**Integration Testing:**
- Button system compatibility across existing component ecosystem
- Casino variant integration with conversion tracking system
- State management integration for enhanced button interactions
- Cross-browser compatibility validation

**Accessibility Testing:**
- WCAG AA compliance verification for all button variants
- Screen reader compatibility with enhanced casino states
- Keyboard navigation testing for casino gaming workflows
- Touch accessibility validation for mobile casino interactions

**Performance Testing:**
- Animation performance measurement at 60fps target
- Bundle size impact assessment for UnifiedButton component
- Memory usage analysis for enhanced interaction states
- Core Web Vitals maintenance with casino button enhancements

## Tasks / Subtasks

### Task 1: Extend SCSS Button System with Casino Variants (AC: 1, 4)
- [ ] 1.1. Add casino variant classes to `_button.scss` (`.variant-casino`, `.variant-premium`)
- [ ] 1.2. Implement `.button.size-lg` for enhanced mobile casino interactions
- [ ] 1.3. Integrate casino colors from Story 5.2 with button variant system
- [ ] 1.4. Preserve existing hover animations and focus states for new variants
- [ ] 1.5. Unit test: Validate SCSS variant compilation and CSS output accuracy

### Task 2: Create UnifiedButton Bridge Component (AC: 2)
- [ ] 2.1. Develop UnifiedButton component with dual API support (SCSS + Shadcn)
- [ ] 2.2. Implement Radix UI Slot pattern for component composition
- [ ] 2.3. Add enhanced state management (loading, success, disabled)
- [ ] 2.4. Create casino-specific interaction state animations
- [ ] 2.5. Unit test: Bridge component API compatibility and state management

### Task 3: Maintain Backward Compatibility (AC: 3)
- [ ] 3.1. Verify all existing `.button` APIs continue to function unchanged
- [ ] 3.2. Test existing component integration with enhanced button system
- [ ] 3.3. Preserve touch target sizes and mobile accessibility features
- [ ] 3.4. Ensure graceful fallback for unsupported casino variants
- [ ] 3.5. Integration test: Existing component ecosystem compatibility validation

### Task 4: Enhance Accessibility and Interaction States (AC: 5)
- [ ] 4.1. Implement enhanced focus indicators for casino variants
- [ ] 4.2. Add screen reader announcements for interactive states
- [ ] 4.3. Create casino-optimized hover and active state animations
- [ ] 4.4. Validate WCAG contrast ratios for all casino button combinations
- [ ] 4.5. Accessibility test: Screen reader and keyboard navigation validation

### Task 5: Implement Gradual Migration System (AC: 6)
- [ ] 5.1. Create feature flags for A/B testing casino button variants
- [ ] 5.2. Implement coexistence patterns for SCSS and Shadcn button systems
- [ ] 5.3. Document migration guide for development team adoption
- [ ] 5.4. Create automated testing for migration pattern validation
- [ ] 5.5. Integration test: End-to-end migration workflow verification

### Task 6: Update Shadcn Button Integration (AC: 1, 2, 4)
- [ ] 6.1. Extend Shadcn button component with casino variant support
- [ ] 6.2. Add casino color integration to CVA variant system
- [ ] 6.3. Implement size variants for mobile casino optimization
- [ ] 6.4. Create casino interaction state management
- [ ] 6.5. Unit test: Shadcn button enhancement compatibility and functionality

## Project Structure Notes

**Alignment with Existing Architecture:**
- Button system enhancement follows established SCSS architecture in `_button.scss`
- UnifiedButton component respects existing React component patterns in `/components/ui/`
- Migration strategy aligns with brownfield enhancement principles
- Testing approach compatible with current Vitest + Playwright framework

**Integration Compatibility:**
- Casino variant implementation preserves existing CSS variable system
- Bridge component maintains compatibility with Astro SSR and React islands architecture
- Coexistence patterns enable gradual adoption without breaking changes
- Performance impact minimal due to CSS-only animation approach

**No Architecture Conflicts Identified:**
- Enhanced button system extends existing patterns without conflicts
- Component bridge maintains separation between SCSS and React implementations
- Migration strategy respects existing component domain organization
- Testing requirements align with established accessibility and performance standards

## Testing Requirements

**Unit Testing (Vitest):**
- UnifiedButton component prop interface and state management validation
- SCSS casino variant compilation and output verification
- Accessibility feature integration testing
- Performance impact measurement for enhanced interactions

**Integration Testing:**
- Button system compatibility across existing component ecosystem
- Casino variant integration with conversion tracking analytics
- Cross-component button usage pattern validation
- State management integration for enhanced interaction states

**End-to-End Testing (Playwright):**
- Complete casino button interaction workflow testing
- Mobile casino game button accessibility validation
- Cross-browser casino variant rendering verification
- Performance measurement for enhanced button interactions

**Accessibility Testing (Axe):**
- WCAG AA compliance verification for all casino button variants
- Screen reader compatibility with enhanced interaction states
- Keyboard navigation testing for casino gaming workflows
- Touch accessibility validation for mobile casino button interactions

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-19 | v1.0 | Initial story creation for unified button system architecture | Development Agent (James) |

## Dev Agent Record

### Agent Model Used
*To be populated during implementation*

### Debug Log References
*To be populated during implementation*

### Completion Notes List
*To be populated during implementation*

### File List
*To be populated during implementation*

## QA Results

*Results from QA Agent review to be completed after implementation*